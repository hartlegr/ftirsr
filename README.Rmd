---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

[![R-CMD-check](https://github.com/sds270-s22/ftirsr/workflows/R-CMD-check/badge.svg)](https://github.com/sds270-s22/ftirsr/actions)

[![Lifecycle: stable](https://img.shields.io/badge/lifecycle-stable-brightgreen.svg)](https://lifecycle.r-lib.org/articles/stages.html#stable)

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# ftirsr <img src="./data-raw/Sticker/ftiRRRs.png" align="right" height=140/>


The goal of `ftirsr` is to help easily create a Partial Least Squares Regression model to estimate composition of natural compounds such as biogenic silica and total organic carbon in lake sediment core samples. 

## Installation

The development version from GitHub can be accessed like so:

``` {r}
remotes::install_github("sds270-s22/ftirsr")
```

## Example


```{r example, message = FALSE, warning = FALSE}
library(ftirsr)
library(tidyverse)

# This shows finding the maximum biogenic silica percentage in the dataset
max(greenland$bsi)
```

```{r, warning = FALSE, message = FALSE}
# This shows how to easily read a directory of FTIRS samples into R while attaching Wet Chemistry values and interpolating onto a vector of rounded wavenumbers for ease of interpretation

my_data <- read_ftirs(dir_path = "~/ftirsr/tests/testthat/test_samples",
                      wet_chem_path = "~/ftirsr/tests/testthat/wet-chem-data.csv")

head(my_data)
```

```{r, warning = FALSE, message = FALSE}
# This shows how to read a directory without interpolation
# Note the difference in wavenumbers
my_data_no_interp <- read_ftirs(dir_path = "~/ftirsr/tests/testthat/test_samples",
                      wet_chem_path = "~/ftirsr/tests/testthat/wet-chem-data.csv",
                      interpolate = FALSE)

head(my_data_no_interp)

```

```{r}
 # This shows pivoting the ftirs dataframe to the wide format necessary to run in a PLS model
my_data_wide <- my_data %>%
  pivot_wider()

head(my_data_wide)
```

```{r}
# It is just as easy to pivot back
# Wet Chem data is included, so we denote that with wet_chem = TRUE
my_data_long <- my_data_wide %>%
  pivot_longer(wet_chem = TRUE)

head(my_data_long)
```


```{r}
# We can confirm that this object is class `ftirs`, which is necessary to access methods, such as predict.ftirs()
is.ftirs(my_data_wide)
```

```{r}
# It is easy to predict the amount of Biogenic Silica in your sample using our model that is trained on 131 arctic lake sediment core samples
preds <- predict(my_data_wide)
preds
```

```{r}
# We can specify the number of components we want to see, as this is inherited from the predict.mvr method
preds <- predict(my_data_wide, ncomp = 4)
preds
```

```{r, eval = FALSE}
# If we want to see the details of the training model, we can call arctic_mod() 
mod <- arctic_mod()
summary(mod())

# We can also use this to create plots with predictions
pplot <- pls::predplot(mod, ncomp = 10, newdata =  my_data_wide, asp = 1, line = TRUE)

pplot
```

```{r, warning = FALSE, message = FALSE}
# It is also possible to read a single sample file using read_ftirs_file()

one_sample <- read_ftirs_file(single_filepath = "~/ftirsr/tests/testthat/test_samples/FISK-10.0.csv")

head(one_sample)
```



